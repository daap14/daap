# Technical Plan — v0.1 (Foundation / Walking Skeleton)

## Overview
Establish the Go project, dev environment with local K8s + CNPG operator, and a minimal API that proves Go ↔ Kubernetes ↔ CNPG connectivity. No domain model, no CRUD — just the skeleton.

---

## Task Order

### Phase 1: Design & Decisions

| # | Issue | Task | Owner | Complexity | Depends On |
|---|-------|------|-------|-----------|-----------|
| 1 | [#1](https://github.com/daap14/daap/issues/1) | Write ADR 001 — Tech Stack + project layout (Go, Chi, client-go, CNPG types, config, logging, testing, directory structure) | architect | M | — |
| 2 | [#11](https://github.com/daap14/daap/issues/11) | Design API response envelope & health endpoint schema (OpenAPI stub) | architect | S | #1 |

### Phase 2: Infrastructure & Tooling

| # | Issue | Task | Owner | Complexity | Depends On |
|---|-------|------|-------|-----------|-----------|
| 3 | [#5](https://github.com/daap14/daap/issues/5) | Create Makefile with all targets | local-devops | M | #1 |
| 4 | [#4](https://github.com/daap14/daap/issues/4) | Create multi-stage Dockerfile + docker-compose.yml | local-devops | M | #1 |
| 5 | [#29](https://github.com/daap14/daap/issues/29) | Create `.env.example` with config docs | local-devops | S | #4 |
| 6 | [#3](https://github.com/daap14/daap/issues/3) | Set up Kind cluster + CNPG operator automation | local-devops | L | #5 |
| 7 | [#6](https://github.com/daap14/daap/issues/6) | Set up golangci-lint config (`.golangci.yml`) | local-devops | S | #1 |

### Phase 3: Implementation

| # | Issue | Task | Owner | Complexity | Depends On |
|---|-------|------|-------|-----------|-----------|
| 8 | [#2](https://github.com/daap14/daap/issues/2) | Scaffold Go project: `go mod init`, `cmd/server/main.go`, packages | implementer | M | #1, #5 |
| 9 | [#28](https://github.com/daap14/daap/issues/28) | Implement config package (`internal/config/`) | implementer | S | #2 |
| 10 | [#7](https://github.com/daap14/daap/issues/7) | Implement K8s client (`internal/k8s/`) — in-cluster + out-of-cluster, CNPG types | implementer | M | #2, #28 |
| 11 | [#9](https://github.com/daap14/daap/issues/9) | Implement response envelope middleware | implementer | M | #11, #2 |
| 12 | [#8](https://github.com/daap14/daap/issues/8) | Implement health endpoint (`GET /health`) | implementer | M | #7, #9 |
| 13 | [#30](https://github.com/daap14/daap/issues/30) | Wire up Chi router, middleware, and graceful shutdown | implementer | S | #9, #8 |

### Phase 4: Testing & Quality

| # | Issue | Task | Owner | Complexity | Depends On |
|---|-------|------|-------|-----------|-----------|
| 14 | [#31](https://github.com/daap14/daap/issues/31) | Unit tests: config package | qa | S | #28 |
| 15 | [#32](https://github.com/daap14/daap/issues/32) | Unit tests: response envelope middleware | qa | S | #9 |
| 16 | [#33](https://github.com/daap14/daap/issues/33) | Unit tests: health endpoint (mocked K8s) | qa | M | #8 |
| 17 | [#34](https://github.com/daap14/daap/issues/34) | Integration test: health endpoint (real HTTP, mocked K8s) | qa | M | #30 |

### Phase 5: CI/CD & Final Polish

| # | Issue | Task | Owner | Complexity | Depends On |
|---|-------|------|-------|-----------|-----------|
| 18 | [#10](https://github.com/daap14/daap/issues/10) | GitHub Actions CI pipeline (install, lint, build, unit test) | local-devops | M | #6, #30 |
| 19 | [#35](https://github.com/daap14/daap/issues/35) | Verify `make lint` passes on full codebase | local-devops | S | #6, #30 |
| 20 | [#36](https://github.com/daap14/daap/issues/36) | E2E verification: cluster-up + cnpg-install + dev + curl /health | local-devops | M | #3, #30 |

---

## Task Summary by Owner

| Owner | Issues | S | M | L | Total |
|-------|--------|---|---|---|-------|
| **architect** | #1, #11 | 1 | 1 | 0 | 2 tasks |
| **local-devops** | #5, #4, #29, #3, #6, #10, #35, #36 | 3 | 3 | 1 | 8 tasks |
| **implementer** | #2, #28, #7, #9, #8, #30 | 2 | 4 | 0 | 6 tasks |
| **qa** | #31, #32, #33, #34 | 2 | 2 | 0 | 4 tasks |
| **Total** | **20 tasks** | **8** | **10** | **1** | |

---

## Critical Path

```
#1 (ADR + layout) → #2 (scaffold) → #28 (config) → #7 (K8s client) → #8 (health endpoint) → #30 (wire up) → #34 (integration test) → #10 (CI)
```

8 tasks on the critical path. Phases 2-3 can partially parallelize (local-devops works on infra while implementer codes).

---

## Recommended Execution Order

1. **architect** does #1, #11 first (unblocks everything)
2. **local-devops** starts #5, #4, #6 in parallel once #1 is done
3. **implementer** starts #2 (scaffold) once #1 is done + #5 (Makefile) is ready, then flows through #28 → #7 → #9 → #8 → #30
4. **local-devops** works on #3 (Kind/CNPG) in parallel with implementation
5. **qa** starts testing as each package lands (#31, #32, #33 can start as soon as their target is done)
6. **local-devops** finishes with #10 (CI) and final verification (#35, #36) once code is complete

---

## Open Questions

- **K8s in CI**: Should CI run a Kind cluster for integration tests, or keep CI unit-test-only for v0.1? *(Recommendation: unit-only for v0.1, add K8s CI in v0.2)*
- **Hot reload tooling**: Which tool for `make dev` hot reload? `air` is the standard Go choice. *(Recommendation: `cosmtrek/air`)*
- **Config library**: Use `envconfig`, `viper`, or plain `os.Getenv` with manual parsing? *(Decision in ADR 001)*

## Risks

| Risk | Impact | Mitigation |
|------|--------|-----------|
| CNPG Go API types may have version compatibility issues with client-go | M | Pin compatible versions early, test in #7 |
| Kind cluster setup may be slow/flaky on different OS | L | Document requirements, test on macOS + Linux |
| golangci-lint config too strict for initial dev velocity | S | Start permissive, tighten in later iterations |
